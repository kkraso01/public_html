<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drone Stability Demo | Konstantin Krasovitskiy</title>

  <!-- Tailwind CSS - Production via jsDelivr Play CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- Custom styles for theme consistency -->
  <style>
    /* Fullscreen canvas for NN / constellation background */
    #nn-bg {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #020617 100%);
      pointer-events: none;
    }

    /* Slight glass effect for hero buttons when over the animated background */
    .glass-btn {
      backdrop-filter: blur(8px);
      background-color: rgba(79, 70, 229, 0.85);
    }

    .glass-outline {
      backdrop-filter: blur(8px);
      background-color: rgba(15, 23, 42, 0.7);
    }

    /* Optional: subtle fade-in for hero */
    .fade-in {
      animation: fadeIn 1.2s ease-out forwards;
      opacity: 0;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    /* HUD side navigation */
    .hud-nav {
      opacity: 0.25;
      transition: opacity 0.4s ease;
    }

    .hud-nav:hover,
    .hud-nav:focus-within {
      opacity: 1;
    }

    .hud-nav .nav-link {
      backdrop-filter: blur(10px);
      background: linear-gradient(120deg, rgba(15, 23, 42, 0.65), rgba(51, 65, 85, 0.4));
      border: 1px solid rgba(99, 102, 241, 0.35);
      transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    .hud-nav .nav-link:hover {
      border-color: rgba(129, 140, 248, 0.9);
      transform: translateX(2px);
    }

    .hud-nav .nav-link.active {
      border-color: rgba(129, 140, 248, 1);
      box-shadow: 0 15px 40px rgba(99, 102, 241, 0.35);
    }

    .hud-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(79, 70, 229, 0.12);
      border: 1px solid rgba(129, 140, 248, 0.35);
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .mission-brief {
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .cue-badge {
      font-size: 11px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.14);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      padding: 6px 10px;
      transition: opacity 0.3s ease;
    }

    .metric-flash {
      animation: flash 0.6s ease;
    }

    @keyframes flash {
      0% {
        color: #a5b4fc;
      }

      50% {
        color: #22c55e;
      }

      100% {
        color: #e5e7eb;
      }
    }

    /* Slider Styling */
    .pid-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: linear-gradient(to right, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.4));
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    .pid-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: #4f46e5;
      border: 2px solid #6366f1;
      border-radius: 50%;
      cursor: pointer;
      transition: box-shadow 0.2s;
    }

    .pid-slider::-webkit-slider-thumb:hover {
      box-shadow: 0 0 8px rgba(79, 70, 229, 0.6);
    }

    .pid-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      background: #4f46e5;
      border: 2px solid #6366f1;
      border-radius: 50%;
      cursor: pointer;
      transition: box-shadow 0.2s;
    }

    .pid-slider::-moz-range-thumb:hover {
      box-shadow: 0 0 8px rgba(79, 70, 229, 0.6);
    }


  </style>
</head>

<body class="bg-gray-950 text-gray-100 font-sans scroll-smooth">

  <!-- Neural Network / Constellation Background -->
  <canvas id="nn-bg"></canvas>

  <!-- Side Navigation (Command Links) -->
  <nav class="hidden md:flex fixed left-6 top-1/2 -translate-y-1/2 z-40 flex-col gap-3 hud-nav">
    <div class="text-[11px] tracking-[0.3em] text-indigo-300/80 uppercase mb-2">Navigation</div>
    <a href="home.html" class="nav-link px-4 py-2 rounded-xl text-sm text-gray-100">Back to Portfolio
      <span class="text-[11px] text-indigo-300/80 ml-2">↵</span></a>
  </nav>

  <!-- Hero Header -->
  <section class="py-20 px-6 text-center relative max-w-6xl mx-auto">
    <div class="flex flex-col gap-3 mb-10">
      <p class="mission-brief text-indigo-300/80">Advanced Control Systems • Real-time Physics • LQR Feedback</p>
      <h2 class="text-4xl font-bold">Drone Stability Demo</h2>
      <p class="text-gray-400 max-w-3xl">
        Geometric controller with real-time gain tuning for quadrotor attitude and position control. Adjust PID-like gains interactively and watch the drone stabilize in real-time.
      </p>
    </div>
  </section>

  <!-- Demo Section -->
  <section id="drone-stability" data-nav-section class="py-20 px-6 relative max-w-6xl mx-auto">
    <!-- Canvas Container -->
    <article class="space-y-4 bg-gray-900/70 p-6 rounded-2xl border border-gray-800 shadow-lg mb-8">
      <div class="flex items-center gap-3">
        <span class="hud-chip">Real-time Simulation</span>
        <span class="cue-badge">Interactive controller tuning</span>
      </div>
      <div>
        <h3 class="text-2xl font-semibold">Quadrotor Physics & Control</h3>
        <p class="text-gray-400">Watch the drone respond to controller gains. The physics engine runs at 240 Hz with geometric attitude control.</p>
      </div>
      <div id="drone-container" style="width: 100%; height: 500px; background: rgba(12, 17, 28, 0.6); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; position: relative;"></div>
    </article>

    <!-- Controls Panel -->
    <article class="space-y-4 bg-gray-900/70 p-6 rounded-2xl border border-gray-800 shadow-lg">
      <div class="flex items-center gap-3">
        <span class="hud-chip">Controller Tuning</span>
        <span class="cue-badge">Adjust gains in real-time</span>
      </div>
      <div>
        <h3 class="text-2xl font-semibold">Stability Gains</h3>
        <p class="text-gray-400">Use the sliders to tune position and attitude controller parameters. The drone targets position (0, 1.5, 0).</p>
      </div>
      <!-- Control Panel will be injected here by drone demo -->
      <div id="control-panel-container"></div>
    </article>
  </section>

  <!-- Footer -->
  <section class="py-12 px-6 text-center border-t border-gray-800/50 relative max-w-6xl mx-auto">
    <p class="text-gray-400 text-sm">
      Physics simulation at 240 Hz • Three.js rendering • Geometric Control Theory
    </p>
    <p class="text-gray-500 text-xs mt-2">
      <a href="home.html" class="text-indigo-400 hover:text-indigo-300 transition">← Back to Portfolio</a>
    </p>
  </section>

  <!-- Background Animation Script (same as home.html) -->
  <script>
    // Simple NN background animation
    const nnCanvas = document.getElementById('nn-bg');
    const nnCtx = nnCanvas.getContext('2d');

    function resizeNNCanvas() {
      nnCanvas.width = window.innerWidth;
      nnCanvas.height = window.innerHeight;
    }
    resizeNNCanvas();
    window.addEventListener('resize', resizeNNCanvas);

    let particles = [];
    class Particle {
      constructor() {
        this.x = Math.random() * nnCanvas.width;
        this.y = Math.random() * nnCanvas.height;
        this.vx = (Math.random() - 0.5) * 0.5;
        this.vy = (Math.random() - 0.5) * 0.5;
        this.radius = Math.random() * 1.5;
        this.opacity = Math.random() * 0.5 + 0.3;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.x < 0 || this.x > nnCanvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > nnCanvas.height) this.vy *= -1;
      }

      draw() {
        nnCtx.fillStyle = `rgba(129, 140, 248, ${this.opacity})`;
        nnCtx.beginPath();
        nnCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        nnCtx.fill();
      }
    }

    for (let i = 0; i < 80; i++) {
      particles.push(new Particle());
    }

    function animateNN() {
      nnCtx.clearRect(0, 0, nnCanvas.width, nnCanvas.height);
      particles.forEach((p) => {
        p.update();
        p.draw();
      });
      requestAnimationFrame(animateNN);
    }
    animateNN();
  </script>

  <!-- Drone Stability Demo Import and Initialization -->
  <script>
    // Ensure Three.js is loaded before initializing
    function initDroneDemo() {
      if (typeof THREE === 'undefined') {
        console.error('Three.js not loaded yet');
        setTimeout(initDroneDemo, 100);
        return;
      }

      import('./drones/stationary/stationary_test.js').then(module => {
        const { initStationaryHoverDemo } = module;
        const container = document.getElementById('drone-container');
        const controlPanel = document.getElementById('control-panel-container');

        if (!container) {
          console.error('Drone container not found!');
          return;
        }

        try {
          const demoInstance = initStationaryHoverDemo(container, {
            width: container.clientWidth,
            height: container.clientHeight,
            controlContainer: controlPanel,
          });

          // Handle visibility changes
          document.addEventListener('visibilitychange', () => {
            demoInstance.setPausedFromVisibility(!document.hidden);
          });

          // Handle window resize
          window.addEventListener('resize', () => {
            demoInstance.handleResize();
          });
        } catch (error) {
          console.error('Error initializing drone demo:', error);
        }
      }).catch(err => {
        console.error('Failed to load drone demo module:', err);
      });
    }

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDroneDemo);
    } else {
      initDroneDemo();
    }
  </script>

</body>

</html>
